{% extends "base.html" %}
{% block content %}

<h1>Einstellungen</h1>

<form method="post" action="{{ url_for('settings') }}" class="settings-form">

  <div class="settings-grid">
    <!-- Projektname -->
    <div class="full">
      <label for="project_name">Projektname</label>
      <input id="project_name" name="project_name" type="text" value="{{ cfg.project_name|e }}">
    </div>

    <!-- Projektpfad + Ordner wählen -->
    <div class="full">
      <label for="project_path">Projektpfad (absolut)</label>
      <div class="inline-row">
        <input id="project_path" name="project_path" type="text" value="{{ cfg.project_path|e }}" autocomplete="off">
        <button type="button" id="btnChoose" class="btn btn--ghost" aria-describedby="pathHelp">Ordner wählen…</button>
      </div>
      <div id="pathHelp" class="muted" style="margin-top:.35rem">
        {% if cfg.project_path %}
          Aktuell: <code>{{ cfg.project_path }}</code>
        {% else %}
          Noch kein Ordner gewählt
        {% endif %}
      </div>
    </div>

    <!-- Branch -->
    <div>
      <label for="branch">Branch</label>
      <input id="branch" name="branch" type="text" value="{{ cfg.branch|e }}">
    </div>

    <!-- WIP-Branch (optional) -->
    <div>
      <label for="wip_branch">WIP-Branch (optional)</label>
      <input id="wip_branch" name="wip_branch" type="text" value="{{ cfg.wip_branch|e }}">
    </div>

    <!-- Remote-URL -->
    <div class="full">
      <label for="remote_url">Remote URL</label>
      <input id="remote_url" name="remote_url" type="text" value="{{ cfg.remote_url|e }}">
    </div>

        <!-- Auto-Commit -->
    <div class="full">
      <label for="auto_commit">Auto-Commit</label>
      <input id="auto_commit" name="auto_commit" type="checkbox" value="1" {% if cfg.auto_commit %}checked{% endif %}>
    </div>

    <!-- Auto-Push -->
    <div class="full">
      <label for="auto_push">Auto-Push</label>
      <input id="auto_push" name="auto_push" type="checkbox" value="1" {% if cfg.auto_push %}checked{% endif %}>
    </div>

    <!-- Mirror-on-Start -->
    <div class="full">
      <label for="mirror_on_start">Mirror on Start</label>
      <input id="mirror_on_start" name="mirror_on_start" type="checkbox" value="1" {% if cfg.mirror_on_start %}checked{% endif %}>
    </div>

    <!-- Batch-Fenster -->
    <div>
      <label for="batch_window_sec">Batch-Fenster (Sek.)</label>
      <input id="batch_window_sec" name="batch_window_sec" type="number" step="0.1" min="0" value="{{ cfg.batch_window_sec }}">
    </div>

    <!-- Debounce -->
    <div>
      <label for="debounce_ms">Debounce (ms)</label>
      <input id="debounce_ms" name="debounce_ms" type="number" step="1" min="0" value="{{ cfg.debounce_ms }}">
    </div>

    <!-- Max. Backups -->
    <div>
      <label for="max_backups">Max. Backups/Datei</label>
      <input id="max_backups" name="max_backups" type="number" step="1" min="0" value="{{ cfg.max_backups }}">
    </div>

    <!-- Flash-Dauer -->
    <div>
      <label for="flash_duration_sec">Flash-Dauer (Sek.)</label>
      <input id="flash_duration_sec" name="flash_duration_sec" type="number" step="1" min="1" value="{{ cfg.flash_duration_sec }}">
    </div>
  </div>

  <div class="settings-actions">
    <button type="submit" class="btn btn--primary">Speichern</button>
  </div>
</form>

<script>
  // Ordnerdialog → füllt das Pfadfeld
  (function () {
    const btn  = document.getElementById('btnChoose');
    const input = document.getElementById('project_path');
    if (!btn || !input) return;

    btn.addEventListener('click', async () => {
      btn.disabled = true;
      const oldText = btn.textContent;
      btn.textContent = 'Öffne…';
      try {
        const res = await fetch('{{ url_for("choose_folder") }}', { cache: 'no-store' });
        if (!res.ok) return;
        const data = await res.json();
        if (data && data.ok && data.path) {
          input.value = data.path;
        }
      } catch (_) {
        /* ignore */
      } finally {
        btn.textContent = oldText;
        btn.disabled = false;
      }
    });
  })();
</script>

{% endblock %}