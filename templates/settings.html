{% extends "base.html" %}
{% block content %}
<h1>Einstellungen</h1>
<form method="post">
  <label>Projektname <input name="project_name" value="{{ cfg.project_name }}"></label>
  <label>Projektpfad (absolut)
    <input name="project_path" id="projectPath" value="{{ cfg.project_path }}" placeholder="/Users/deinName/Projects/DeinProjekt">
  </label>

  <div style="margin:6px 0 12px;">
    <button type="button" id="btnPick">Ordner wählen…</button>
    <span id="pickedInfo" style="margin-left:8px; color:#555;">
      {% if cfg.project_path %}Aktuell: <code>{{ cfg.project_path }}</code>{% else %}Noch kein Ordner gewählt{% endif %}
    </span>
  </div>

  <script>
    document.getElementById("btnPick").addEventListener("click", async () => {
      try {
        const res = await fetch("/pick-folder", { cache: "no-store" });
        if (!res.ok) {
          const text = await res.text();
          alert(`HTTP ${res.status}: ${text.substring(0, 200)}…`);
          return;
        }
        const data = await res.json();
        if (data.ok && data.path) {
          document.getElementById("projectPath").value = data.path;
          document.getElementById("pickedInfo").innerHTML = 'Gewählt: <code>' + data.path + '</code>';
        } else {
          alert("Kein Ordner gewählt" + (data.error ? " – " + data.error : ""));
        }
      } catch (e) {
        alert("Fehler beim Öffnen des Ordner-Dialogs: " + e);
      }
    });
  </script>

  <label>Branch <input name="branch" value="{{ cfg.branch }}"></label>
  <label>Remote URL <input name="remote_url" value="{{ cfg.remote_url }}" placeholder="https://github.com/user/repo.git"></label>
  <label>WIP-Branch (optional) <input name="wip_branch" value="{{ cfg.wip_branch }}"></label>
  <div class="row">
    <label><input type="checkbox" name="auto_commit" {% if cfg.auto_commit %}checked{% endif %}> Auto-Commit</label>
    <label><input type="checkbox" name="auto_push" {% if cfg.auto_push %}checked{% endif %}> Auto-Push</label>
  </div>
  <div class="row">
    <label>Batch-Fenster (Sek.) <input name="batch_window_sec" type="number" min="1" value="{{ cfg.batch_window_sec }}"></label>
    <label>Debounce (ms) <input name="debounce_ms" type="number" min="0" value="{{ cfg.debounce_ms }}"></label>
    <label>Max. Backups/Datei <input name="max_backups" type="number" min="0" value="{{ cfg.max_backups }}"></label>
  </div>
  <button>Speichern</button>
</form>
{% endblock %}
